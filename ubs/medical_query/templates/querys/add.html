{% extends 'core/base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Realizar Nova Consulta{% endblock %}

{% block body %}


<div class="content col-md-12">
    <div class="animated fadeIn">
        <form method="post">
            {% csrf_token %}
                <div class="row" id=query>
                    <div class="col-md-10" style="margin: 20px auto;">
                        <div class="card">
                            <div class="card-header"><strong>{{patient.full_name}}</strong>
                                <a href="{% url 'medical_query:cancel_query' patient_pk forwarding_pk %}">
                                    <label class="btn btn-danger" style="margin-left: 70%; font-size: 12px; border-radius: 2px;">CANCELAR</label>
                                </a>
                                {% if last_query %}
                                    <p>Última consulta em {{last_query}}</p>
                                {% else %}
                                    <p>Primeira Consulta</p>
                                {% endif %}
                                </div>
                    <fieldset>

                        <div class="form-group">
                           <div id="1">
                                {% for field in form %}
                                    {% if field.errors %}
                                        <div
                                            class="col-md-{% if field.name in 'name' %}8{% elif field.name in 'main_complaint\email' %}6{% elif field.name in 'username\sex\birth_date\marital_status\phone\cpf\rg\matricula' %}4{% elif field.name in 'nome_mae\nome_pai' %}6{% else %}12{% endif %} margin-bottom-15 has-error has-feedback">
                                            <label class="control-label">{{ field.label }}</label>
                                            {{ field|add_class:"form-control input-md" }}
                                            <span class="text-danger"> <strong>{{ field.help_text }}</strong> </span>
                                            {% for error in field.errors%}
                                            <span class="help-inline error">{{ error}}</span>
                                            {% endfor%}
                                        </div>
                                    {%else%}
                                        {% if field.name != 'cid10' and field.name != 'examRequest' and field.name != 'gestational_history' and field.name != 'repoductive_health'%}

                                            <div
                                                class="col-md-{% if field.name in 'responsible_academics\type_query\staff_CRM' %}12
                                                {% elif field.name in 'epidemiological_history/previous_pathological_history/family_history/physiological_personal_antecedents' %}6       
                                                {% elif field.name in 'physical_exam\pa_exam\p_exam\fc_exam\fr_exam\tax_exam\peso_exam\heigth_exam\staff_CRM' %}3         
                                                {% else %}6
                                                {% endif %} margin-bottom-15">

                                                <label  class="control-label" style="margin-top: 10px;">{{ field.label }}</label>
                                                {{ field|add_class:"form-control input-md" }}
                                                <span class="text-danger"> <strong>{{ field.help_text }}</strong></span>
                                            </div>
                                        {% endif %}
                                {%endif%}
                                {% endfor %}
                            </div>

                            <div id="2">
                                {% for field in second_form %}
                                    {% if field.errors %}
        
                                        <div
                                            class="col-md-{% if field.name in 'pa\p\fc' %}4
                                                        {% elif field.name in 'color\sex\marital_state\phone\fax\email' %}4
                                                        {% else %}6
                                                        {% endif %} margin-bottom-15">
                                        >
                                            <label class="control-label">{{ field.label }}</label>
                                            {{ field|add_class:"form-control input-md" }}
                                            <span class="text-danger"> <strong>{{ field.help_text }}</strong> </span>
                                            {% for error in field.errors%}
                                            <span class="help-inline error">{{ error }}</span>
                                            {% endfor%}
                                        </div>
                                    {%else%}
                                        <div 
                                        class="col-md-{% if field.name in 'pa\p\fc' %}4
                                                        {% elif field.name in 'color\sex\marital_state\phone\fax\email' %}4
                                                        {% else %}6
                                                        {% endif %} margin-bottom-15">
                                        
                                            <label class="control-label" style="margin-top: 10px;">{{ field.label }}</label>
                                            {{ field|add_class:"form-control input-md" }}
                                            <span class="text-danger"> <strong>{{ field.help_text }}</strong></span>
                                        </div>
                                    {%endif%}
                                {% endfor %}
                            </div>



                            <div id="3">
                                {% for field in form %}
                                {% if field.errors %}
                                <div
                                    class="col-md-{% if field.name in 'name' %}8{% elif field.name in 'main_complaint\email' %}6{% elif field.name in 'username\sex\birth_date\marital_status\phone\cpf\rg\matricula' %}4{% elif field.name in 'nome_mae\nome_pai' %}6{% else %}12{% endif %} margin-bottom-15 has-error has-feedback">
                                    <label class="control-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control input-md" }}
                                    <span class="text-danger"> <strong>{{ field.help_text }}</strong> </span>
                                    {% for error in field.errors%}
                                    <span class="help-inline error">{{ error}}</span>
                                    {% endfor%}
                                </div>
                                {%else%}
                                {% if field.name == 'gestational_history' or field.name == 'repoductive_health' %}
                            
                                <div class="col-md-12 margin-bottom-15">
                            
                                    <label class="control-label" style="margin-top: 10px;">{{ field.label }}</label>
                                    {{ field|add_class:"form-control input-md" }}
                                    <span class="text-danger"> <strong>{{ field.help_text }}</strong></span>
                                </div>
                                {% endif %}
                                {%endif%}
                                {% endfor %}
                            </div>

                            
                            <div id="4" >
                            
                                <div class="col-md-12">
                                    <label class="control-label" style="margin-top: 10px;">{{ form.cid10.label }}</label>
                                    {{form.cid10|add_class:"col-md-12"}}
                                </div>
                            
                                <br>
                                <div class="col-md-12">
                                    <label class="control-label" style="margin-top: 10px;">{{ form.examRequest.label }}</label>
                                    {{form.examRequest|add_class:"col-md-12"}}
                                </div>
                            </div>
                            
                            <br>
                            <br>

                            <div id="5">
                                
                                <div class="card">
                                    <div class="card-body" >
                                        <table class="table table-striped table-bordered" id="usercommitee" class="link-formset">
                                            <thead>
                                                <tr>
                                                    <th>Medicamento</th>
                                                    <th>Pescrição</th>
                                                    <th>Ação</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for has_medicine in third_form %}
                                                    {% if has_medicine.errors %}
                                                        <tr {% if not has_medicine.pk %} class="dynamic-form"{% endif %}  id="{{ usercommittee.prefix }}-row">
                                                            {{ has_medicine.id }}
                                                            <td>
                                                                {{ has_medicine.Medicine_idMedicine|add_class:"form-control input-md" }}
                                                            </td>
                                                            <td>
                                                                {{ has_medicine.amount|add_class:"form-control input-md" }}
                                                                <span class="help-inline error">{{ has_medicine.has_medicine_number.errors}}</span>
                                                            </td>
                                                            <td>{{has_medicine.DELETE}}</td>
                                                        </tr>
                                                    {%else%}
                                                        <tr {% if not has_medicine.pk %} class="dynamic-form"{% endif %}  id="{{ usercommittee.prefix }}-row">
                                                            {{ has_medicine.id }}
                                                            <td>
                                                                {{ has_medicine.medicine|add_class:"form-control input-md" }}
                                                            </td>
                                                            <td>
                                                                {{ has_medicine.amount|add_class:"form-control input-md" }}
                                                            </td>
                                                            <td>{{has_medicine.DELETE}}</td>
                                                        </tr>
                                                    {%endif%}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        {{ third_form.management_form }}
                                    </div>
                                </div>
                            </div>




                        </div>
                    </fieldset>



                    
                    <button type="submit" class="btn btn-success" id="finished" style="border-radius: 3px;">Finalizar</button>



                    </div>

                </div>
            </div>
        </div>
    </div>
    </form>
</div>
</div>



<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/jquery.formset.js' %}"></script>
<script>
    $('#usercommitee tbody tr').formset({
        prefix: '{{ third_form_class.prefix }}',
        addText: '<i class="menu-icon fa fa-plus-square-o"></i> Adicionar',
        addCssClass: 'btn btn-success adicionar',
        deleteText: '<i class="menu-icon fa fa-trash"></i>',
        deleteCssClass: 'btn btn-danger',
        deleteCssClass: 'delete-row',
        formCssClass: 'dynamic-form', 

    });
</script>

{% endblock %}


{% block js %}
    {{ form.media }}
{% endblock %}