{% extends 'core/base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Realizar Nova{% endblock %}

{% block body %}


<div class="content col-md-12">
    <div class="animated fadeIn">
        <form method="post">
            {% csrf_token %}
                <div class="row" id=query>
                    <div class="col-md-10" style="margin: 20px auto;">
                        <div class="card">
                            <div class="card-header"><strong>{{patient.full_name}}</strong>
                            </div>
                            
                    <fieldset>

                        <div class="form-group">
                           <div id="1">
                                {% for field in form %}
                                    {% if field.errors %}
                                        <div
                                            class="col-md-{% if field.name in 'name' %}8{% elif field.name in 'main_complaint\email' %}6{% elif field.name in 'username\sex\birth_date\marital_status\phone\cpf\rg\matricula' %}4{% elif field.name in 'nome_mae\nome_pai' %}6{% else %}12{% endif %} margin-bottom-15 has-error has-feedback">
                                            <label class="control-label">{{ field.label }}</label>
                                            {{ field|add_class:"form-control input-md" }}
                                            <span class="text-danger"> <strong>{{ field.help_text }}</strong> </span>
                                            {% for error in field.errors%}
                                            <span class="help-inline error">{{ error}}</span>
                                            {% endfor%}
                                        </div>
                                    {%else%}
                                            {% if field.name != 'cid10' and field.name != 'examRequest' and field.name != 'gestational_history' and field.name != 'repoductive_health'%}

                                                <div
                                                    class="col-md-{% if field.name in 'summary\review_of_systems\main_complaint\current_health_history\type_query' %}12
                                                    {% elif field.name in 'epidemiological_history/previous_pathological_history/family_history/physiological_personal_antecedents' %}6
                                                    {% elif field.name in 'physical_exam\pa_exam\p_exam\fc_exam\fr_exam\tax_exam\peso_exam\heigth_exam' %}3         
                                                    {% else %}6
                                                    {% endif %} margin-bottom-15">

                                                    <label  class="control-label" style="margin-top: 10px;">{{ field.label }}</label>
                                                    {{ field|add_class:"form-control input-md" }}
                                                    <span class="text-danger"> <strong>{{ field.help_text }}</strong></span>
                                                </div>
                                            {% endif %}
                                {%endif%}
                                {% endfor %}
                            </div>

                            <div id="2" class="d-none">
                                {% for field in second_form %}
                                    {% if field.errors %}
        
                                        <div
                                            class="col-md-{% if field.name in 'pa\p\fc' %}4
                                                        {% elif field.name in 'color\sex\marital_state\phone\fax\email' %}4
                                                        {% else %}6
                                                        {% endif %} margin-bottom-15">
                                        >
                                            <label class="control-label">{{ field.label }}</label>
                                            {{ field|add_class:"form-control input-md" }}
                                            <span class="text-danger"> <strong>{{ field.help_text }}</strong> </span>
                                            {% for error in field.errors%}
                                            <span class="help-inline error">{{ error }}</span>
                                            {% endfor%}
                                        </div>
                                    {%else%}
                                        <div 
                                        class="col-md-{% if field.name in 'pa\p\fc' %}4
                                                        {% elif field.name in 'color\sex\marital_state\phone\fax\email' %}4
                                                        {% else %}6
                                                        {% endif %} margin-bottom-15">
                                        
                                            <label class="control-label" style="margin-top: 10px;">{{ field.label }}</label>
                                            {{ field|add_class:"form-control input-md" }}
                                            <span class="text-danger"> <strong>{{ field.help_text }}</strong></span>
                                        </div>
                                    {%endif%}
                                {% endfor %}
                            </div>



                            <div id="3" class="d-none">
                                {% for field in form %}
                                {% if field.errors %}
                                <div
                                    class="col-md-{% if field.name in 'name' %}8{% elif field.name in 'main_complaint\email' %}6{% elif field.name in 'username\sex\birth_date\marital_status\phone\cpf\rg\matricula' %}4{% elif field.name in 'nome_mae\nome_pai' %}6{% else %}12{% endif %} margin-bottom-15 has-error has-feedback">
                                    <label class="control-label">{{ field.label }}</label>
                                    {{ field|add_class:"form-control input-md" }}
                                    <span class="text-danger"> <strong>{{ field.help_text }}</strong> </span>
                                    {% for error in field.errors%}
                                    <span class="help-inline error">{{ error}}</span>
                                    {% endfor%}
                                </div>
                                {%else%}
                                {% if field.name == 'gestational_history' or field.name == 'repoductive_health' %}
                            
                                <div class="col-md-12 margin-bottom-15">
                            
                                    <label class="control-label" style="margin-top: 10px;">{{ field.label }}</label>
                                    {{ field|add_class:"form-control input-md" }}
                                    <span class="text-danger"> <strong>{{ field.help_text }}</strong></span>
                                </div>
                                {% endif %}
                                {%endif%}
                                {% endfor %}
                            </div>


                            <div id="4" class="d-none">
                            
                                <div class="col-md-12">
                                    <label class="control-label" style="margin-top: 10px;">{{ form.cid10.label }}</label>
                                    {{form.cid10|add_class:"col-md-12"}}
                                </div>
                            
                                <div class="col-md-12">
                                    <label class="control-label" style="margin-top: 10px;">{{ form.examRequest.label }}</label>
                                    {{form.examRequest|add_class:"col-md-12"}}
                                </div>
                            </div>
                            
                            <div id="5" class="d-none">
                                
                                <div class="card">
                                    <div class="card-body" >
                                        <table class="table table-striped table-bordered" id="usercommitee" class="link-formset">
                                            <thead>
                                                <tr>
                                                    <th>Medicamento</th>
                                                    <th>Pescrição</th>
                                                    <th>Ação</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for has_medicine in third_form %}
                                                    {% if has_medicine.errors %}
                                                        <tr {% if not has_medicine.pk %} class="dynamic-form"{% endif %}  id="{{ usercommittee.prefix }}-row">
                                                            {{ has_medicine.id }}
                                                            <td>
                                                                {{ has_medicine.Medicine_idMedicine|add_class:"form-control input-md" }}
                                                            </td>
                                                            <td>
                                                                {{ has_medicine.amount|add_class:"form-control input-md" }}
                                                                <span class="help-inline error">{{ has_medicine.has_medicine_number.errors}}</span>
                                                            </td>
                                                            <td>{{has_medicine.DELETE}}</td>
                                                        </tr>
                                                    {%else%}
                                                        <tr {% if not has_medicine.pk %} class="dynamic-form"{% endif %}  id="{{ usercommittee.prefix }}-row">
                                                            {{ has_medicine.id }}
                                                            <td>
                                                                {{ has_medicine.medicine|add_class:"form-control input-md" }}
                                                            </td>
                                                            <td>
                                                                {{ has_medicine.amount|add_class:"form-control input-md" }}
                                                            </td>
                                                            <td>{{has_medicine.DELETE}}</td>
                                                        </tr>
                                                    {%endif%}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        {{ third_form.management_form }}
                                    </div>
                                </div>
                            </div>




                        </div>
                    </fieldset>



                    <br>
                    

                    
                    <div class="form-actions form-group col-md-4" style="margin-top:3%;">
                        <label onclick="back()"  class="btn btn-danger d-none" id="back" style="border-radius: 3px;">Voltar</label>
                        <label  class="btn btn-primary" id="next" style="border-radius: 3px;" onclick="next()">Proximo</label>                            
                    </div>
                    <button type="submit" class="btn btn-success d-none" id="finished" style="border-radius: 3px;">Finalizar</button>



                    </div>

                </div>
            </div>
        </div>
    </div>
    </form>
</div>
</div>

<script>



    let current = 1

    function next(){
        
        document.getElementById(current).className= "d-none"
        current+=1
        document.getElementById(current).className= ""
        document.getElementById('back').className= "btn btn-danger"
        if(current == 4){
            let inputs_select = document.getElementsByClassName('select2')
            for(i in inputs_select){
                inputs_select[i].style="width:100%"
            }
        }
        if(current == 5){
            document.getElementById('finished').className="btn btn-success"
            document.getElementById('next').className="d-none"
        }
    }
    function back(){

        document.getElementById(current).className= "d-none"
        
        if(current > 1){
            current-=1
        }
        
        if(current ==1){
            document.getElementById('back').className="d-none"
        }
        document.getElementById('next').className="btn btn-primary"
        document.getElementById('finished').className="d-none"
        document.getElementById(current).className= ""

    }

</script>

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/jquery.formset.js' %}"></script>
<script>
    $('#usercommitee tbody tr').formset({
        prefix: '{{ third_form_class.prefix }}',
        addText: '<i class="menu-icon fa fa-plus-square-o"></i> Adicionar',
        addCssClass: 'btn btn-success adicionar',
        deleteText: '<i class="menu-icon fa fa-trash"></i>',
        deleteCssClass: 'btn btn-danger',
        deleteCssClass: 'delete-row',
        formCssClass: 'dynamic-form', 

    });
</script>

{% endblock %}


{% block js %}
    {{ form.media }}
{% endblock %}